<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Im Admin of shop - Indesiz</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body class="container my-5">
  <a href="/admin/orders" class="btn btn-secondary my-3">📄 查看所有订单</a>
    <!-- 导航栏 -->
    <nav class="navbar navbar-expand-sm navbar-dark bg-dark">
    <div class="container-fluid d-flex justify-content-between align-items-center">
        <!-- 左侧 Shop-->
        <div class="d-flex align-items-center flex-grow-1">
        <div class="dropdown">
            <a class="nav-link dropdown-toggle text-white" href="#" role="button" data-bs-toggle="dropdown">Shop</a>
            <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="/">All</a></li>
            <li><a class="dropdown-item" href="#">Clothing</a></li>
            <li><a class="dropdown-item" href="#">Pants</a></li>
            </ul> 
        </div>
        </div>

        <!-- 右侧 -->
        <div class="d-flex align-items-center flex-grow-1 justify-content-end">
        <% if (username) { %>
            <a href="/profile" class="nav-link text-white me-3">
                👤 <%= username %>
            </a>
            <a href="/logout" class="nav-link text-white me-3">
                <i class="bi bi-box-arrow-right"></i> Logout
            </a>
        <% } else { %>
            <a href="/login" class="nav-link text-white me-3">
                <i class="bi bi-person-circle"></i> Login
            </a>
            <a href="/register" class="nav-link text-white me-3">
                <i class="bi bi-person-plus"></i> Register
            </a>
        <% } %>
        <a href="/cart" class="nav-link text-white">
        <i class="bi bi-cart"></i> Cart (（<%= cartCount %>）)
        </a>

        </div>

    </div>
    </nav>
    
  <h2>➕ 添加产品</h2>
  <form action="/admin/add" method="POST" enctype="multipart/form-data" class="mb-5">
    <div class="mb-3">
      <input type="text" name="productName" class="form-control" placeholder="产品名称" required>
    </div>

    <div class="mb-3">
      <label>系列:</label>
      <select name="collectionId" class="form-control" required>
        <% collections.forEach(c => { %>
          <option value="<%= c.collectionId %>"><%= c.collectionName %></option>
        <% }) %>
      </select>
      <small class="text-muted">（必须选择一个系列，想加新系列请先去数据库/后台加）</small>
    </div>

    <div class="mb-3">
      <input type="number" name="quantity" class="form-control" placeholder="数量" required>
    </div>
    <div class="mb-3">
      <input type="number" step="0.01" name="price" class="form-control" placeholder="价格" required>
    </div>
    <div class="mb-3">
      <label>主图 (image):</label>
      <input type="file" name="image" class="form-control" accept=".png,.jpg,.jpeg" required>
    </div>
    <button type="submit" class="btn btn-primary">添加产品</button>
  </form>


  <h2>📦 产品列表</h2>
  <ul class="list-group">
  <% products.forEach(product => { %>
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <div>
        <strong><%= product.productName %></strong> - 数量: <%= product.quantity %> - 价格: $<%= product.price.toFixed(2) %>
        <% if (product.status === 'soldout') { %>
          <span class="badge bg-danger ms-2">已售空</span>
        <% } else { %>
          <span class="badge bg-success ms-2">可销售</span>
        <% } %>
        <br>
        <img src="/<%= product.image %>" alt="<%= product.productName %>" width="100" class="mt-2" />
      </div>

      <!-- 删除按钮 -->
      <form action="/admin/delete/<%= product.productId %>" onclick="return confirm('确定要删除该产品吗？');" method="POST" class="d-inline">
        <button type="submit" class="btn btn-danger btn-sm">删除</button>
      </form>

      <!-- 切换状态按钮 -->
      <form action="/admin/toggle-status/<%= product.productId %> " method="POST" class="d-inline ms-2">
        <button type="submit" class="btn btn-warning btn-sm">
          <%= product.status === 'soldout' ? '恢复销售' : '标为售空' %>
        </button>
      </form>
      
    </li>
  <% }) %>
  </ul>

</body>
</html>
