<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Checkout Page - Indesiz</title>
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body class="bg-light">

  <!-- ğŸ”¹ å¯¼èˆªæ  -->
  <nav class="navbar navbar-expand-sm navbar-light bg-white shadow-sm">
  <div class="container">
    <div class="container-fluid d-flex justify-content-between align-items-center">
      <!-- å·¦ä¾§ Logo -->
      <a class="navbar-brand fw-bold text-dark" href="/">INDESIZ</a>

      <!-- å³ä¾§èœå• -->
      <div class="d-flex align-items-center">
        <% if (user) { %>
          <span href="/profile" class="nav-link text-dark me-3">
            ğŸ‘¤ <%= user.username %>
          </span>
        <% } else { %>
          <a href="/login" class="nav-link text-dark me-3">
            <i class="bi bi-person-circle"></i> Login
          </a>
          <a href="/register" class="nav-link text-dark me-3">
            <i class="bi bi-person-plus"></i> Register
          </a>
        <% } %>
        <a href="/cart" class="nav-link text-dark">
          <i class="bi bi-cart"></i> Cart (<%= cartCount || 0 %>)
        </a>
      </div>
    </div>
    </div>
  </nav>

  <!-- ğŸ”¹ Checkout å†…å®¹ -->
  <div class="container my-5">
    <h2 class="mb-4">ğŸ§¾ Payment ç»“è´¦é¡µé¢</h2>
    
    <!-- é¡¾å®¢ä¿¡æ¯ -->
    <div class="card p-3 mb-4 shadow-sm">
      <h4 class="mb-3">ğŸ“ é¡¾å®¢ä¿¡æ¯</h4>
      <p><strong>Username ç”¨æˆ·å:</strong> <%= user.username %></p>
      <p><strong>Phone Number ç”µè¯å·ç :</strong> <%= user.phone %></p>
      <p><strong>Address åœ°å€:</strong> <%= user.address %></p>
      <p><strong>Email é‚®ç®±:</strong> <%= user.email %></p>
    </div>
    <div class="card p-3 shadow-sm mt-4">
      <h4 class="mb-3">ğŸ’³ Payment Method ä»˜æ¬¾æ–¹å¼</h4>

      <form id="payment-form">
        <div class="form-check mb-2">
              <input class="form-check-input" type="radio" name="paymentMethod" id="card" value="card" checked>
              <label class="form-check-label" for="card">
                Credit / Debit Card (Stripe)
              </label>
            </div>
            <div class="form-check mb-2">
              <input class="form-check-input" type="radio" name="paymentMethod" id="paypal" value="paypal">
              <label class="form-check-label" for="paypal">
                PayPal (Coming Soon)
              </label>
            </div>

            <button type="submit" class="btn btn-success mt-3 w-100 fw-bold">PayNow ç¡®è®¤ä»˜æ¬¾</button>
          </form>
        </div>
    </div>

    <!-- è®¢å•è¯¦æƒ… -->
    <div class="card p-3 shadow-sm">
      <h4 class="mb-3">ğŸ›’ Your Order è®¢å•å†…å®¹</h4>
      <ul class="list-group mb-3">
        <% items.forEach(item => { %>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <%= item.productName %> x <%= item.quantity %> <%= item.size ? '(' + item.size + ')' : '' %>
            <span>$<%= item.total.toFixed(2) %></span>
          </li>
        <% }) %>
      </ul>

      <div class="d-flex justify-content-between">
        <h5 class="fw-bold">Total æ€»æ•°</h5>
        <h5 class="fw-bold">$<%= total.toFixed(2) %> + $10 (Shipping è¿è´¹)</h5>
      </div>

      <div class="d-flex justify-content-between mt-2">
        <h5 class="fw-bold">Grand Total æ€»è®¡</h5>
        <h5 class="fw-bold text-success">$<%= (total + 10).toFixed(2) %></h5>
      </div>

      <form action="/payment" method="GET">
        <button type="submit" class="btn btn-success mt-3 w-100 fw-bold">PayNow ç¡®è®¤ç»“è´¦</button>
      </form>
    </div>
  </div>


<script src="https://js.stripe.com/v3/"></script>
<script>
  const stripe = Stripe('<%= process.env.STRIPE_PUBLISHABLE_KEY %>'); // âš¡ å‰ç«¯ç”¨ publishable key

  const paymentForm = document.getElementById('payment-form');

  paymentForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const method = document.querySelector('input[name="paymentMethod"]:checked').value;

    if (method === 'card') {
      // è°ƒç”¨åç«¯åˆ›å»º Checkout Session
      const res = await fetch('/create-checkout-session', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({})
      });

      const data = await res.json();
      if (data.url) {
        window.location = data.url; // é‡å®šå‘åˆ° Stripe Checkout
      } else {
        alert('åˆ›å»ºä»˜æ¬¾å¤±è´¥ï¼Œè¯·ç¨åå†è¯•');
      }
    } else {
      alert('PayPal åŠŸèƒ½å°šæœªå¼€æ”¾');
    }
  });
</script>

</body>
</html>
